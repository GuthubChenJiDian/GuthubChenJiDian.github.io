import{i as N,l as V,m as X,p as Z,q as ee,s as se,v as te,j as S,x as b,k as e,y as ae,z as le,A as re,R as $,B as ie,C as oe,D as ue,E as ce,G as ne,H as I,I as T,J as de,K as he,L as ve,M as me,N as ye,O as pe,P as Ee,Q as ge,S as M,T as Be,U as f}from"./app-DvCnudRm.js";const we=["/","/note/README(project-homepage).html","/note/","/share/","/resource/","/website/","/note/English/disable.html","/note/English/","/note/software-test/","/note/sundry/disable.html","/note/sundry/encrypt.html","/note/sundry/layout.html","/note/sundry/markdown.html","/note/sundry/page.html","/note/sundry/","/share/life/accumulate.html","/share/life/","/share/study/","/share/study/test.html","/share/work/learning-by-doing.html","/share/work/","/resource/tool/","/resource/tool/Snipaste.html","/resource/tool/Watt%20toolkit.html","/resource/tutorial/Favicon-ico.html","/resource/tutorial/","/resource/tutorial/Selenium.html","/resource/website/","/website/about-site/link.html","/website/about-site/","/website/about-site/website.html","/website/experience/author-information.html","/website/experience/portfolio.html","/website/experience/","/resource/website/acknowledge/JavaGuide.html","/resource/website/acknowledge/","/resource/website/utils/dazidazi.html","/resource/website/utils/free-clashnode.html","/resource/website/utils/","/404.html","/category/","/category/english/","/category/%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/","/category/%E6%8C%87%E5%8D%97/","/category/%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/","/category/%E8%B5%84%E6%BA%90/","/category/%E7%BD%91%E7%AB%99%E7%9B%B8%E5%85%B3/","/tag/","/tag/%E7%A6%81%E7%94%A8/","/tag/%E5%8A%A0%E5%AF%86/","/tag/%E5%B8%83%E5%B1%80/","/tag/markdown/","/tag/%E9%A1%B5%E9%9D%A2%E9%85%8D%E7%BD%AE/","/tag/%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/","/tag/%E7%A7%AF%E7%B4%AF/","/tag/%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95/","/tag/%E5%B7%A5%E5%85%B7/","/tag/%E6%95%99%E7%A8%8B/","/tag/%E5%8F%8B%E6%83%85%E9%93%BE%E6%8E%A5/","/tag/%E5%85%B3%E4%BA%8E%E6%9C%AC%E7%AB%99/","/tag/%E7%BD%91%E7%AB%99/","/article/","/star/","/timeline/"],Ae="SLIMSEARCH_QUERY_HISTORY",E=M(Ae,[]),be=()=>{const{queryHistoryCount:l}=f;return{enabled:l>0,queryHistories:E,addQueryHistory:u=>{E.value=Array.from(new Set([u,...E.value.slice(0,l-1)]))},removeQueryHistory:u=>{E.value=[...E.value.slice(0,u),...E.value.slice(u+1)]}}},Q=l=>we[l.id]+("anchor"in l?`#${l.anchor}`:""),fe="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:j}=f,g=M(fe,[]),ke=()=>({enabled:j>0,resultHistories:g,addResultHistory:o=>{{const u={link:Q(o),display:o.display};"header"in o&&(u.header=o.header),g.value=[u,...g.value.slice(0,j-1)]}},removeResultHistory:o=>{g.value=[...g.value.slice(0,o),...g.value.slice(o+1)]}}),He=l=>{const{page:o,routeLocale:u}=de(),k=he(),r=S(0),B=b(()=>r.value>0),d=ve([]);return me(()=>{const{search:H,terminate:m}=ye(),w=Ee(y=>{const{resultsFilter:D=a=>a,querySplitter:p,suggestionsFilter:F,...i}=k.value;y?(r.value+=1,H(y,u.value,i).then(a=>D(a,y,u.value,o.value)).then(a=>{r.value-=1,d.value=a}).catch(a=>{console.warn(a),r.value-=1,r.value||(d.value=[])})):d.value=[]},f.searchDelay-f.suggestDelay,{maxWait:5e3});pe([l,u],([y])=>w(y.join(" "))),ge(()=>{m()})}),{isSearching:B,results:d}};var xe=N({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(l,{emit:o}){const u=V(),k=X(),r=Z(ee),{addQueryHistory:B,queryHistories:d,removeQueryHistory:H}=be(),{resultHistories:m,addResultHistory:w,removeResultHistory:y}=ke(),D=se(l,"queries"),{results:p,isSearching:F}=He(D),i=te({isQuery:!0,index:0}),a=S(0),h=S(0),q=b(()=>d.value.length>0||m.value.length>0),x=b(()=>p.value.length>0),C=b(()=>p.value[a.value]||null),U=()=>{const{isQuery:s,index:t}=i;t===0?(i.isQuery=!s,i.index=s?m.value.length-1:d.value.length-1):i.index=t-1},O=()=>{const{isQuery:s,index:t}=i;t===(s?d.value.length-1:m.value.length-1)?(i.isQuery=!s,i.index=0):i.index=t+1},P=()=>{a.value=a.value>0?a.value-1:p.value.length-1,h.value=C.value.contents.length-1},_=()=>{a.value=a.value<p.value.length-1?a.value+1:0,h.value=0},z=()=>{h.value<C.value.contents.length-1?h.value+=1:_()},Y=()=>{h.value>0?h.value-=1:P()},R=s=>s.map(t=>Be(t)?t:e(t[0],t[1])),G=s=>{if(s.type==="customField"){const t=ce[s.index]||"$content",[v,c=""]=ne(t)?t[k.value].split("$content"):t.split("$content");return s.display.map(n=>e("div",R([v,...n,c])))}return s.display.map(t=>e("div",R(t)))},A=()=>{a.value=0,h.value=0,o("updateQuery",""),o("close")},J=()=>e("div",{class:"slimsearch-records"},e("div",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.queryHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},d.value.map((s,t)=>{const v=i.isQuery&&i.index===t;return e("li",{class:["slimsearch-record-matches",{active:v}],role:"option","aria-selected":v,onClick:()=>{o("updateQuery",s)}},e("div",[e(I,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},s),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:T,onClick:c=>{c.preventDefault(),c.stopPropagation(),H(t)}})]))}))])),W=()=>e("ul",{class:"slimsearch-records"},e("li",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.resultHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},m.value.map((s,t)=>{const v=!i.isQuery&&i.index===t;return e("li",{class:["slimsearch-record-matches",{active:v}],role:"option","aria-selected":v},e($,{to:s.link,onClick:()=>{A()}},()=>[e(I,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[s.header?e("div",{class:"slimsearch-record-content-header"},s.header):null,e("div",s.display.map(c=>R(c)).flat())]),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:T,onClick:c=>{c.preventDefault(),c.stopPropagation(),y(t)}})]))}))]));return ae("keydown",s=>{if(l.isFocusing){if(x.value){if(s.key==="ArrowUp")Y();else if(s.key==="ArrowDown")z();else if(s.key==="Enter"){const t=C.value.contents[h.value];B(l.queries.join(" ")),w(t),u.push(Q(t)),A()}}else if(s.key==="ArrowUp")U();else if(s.key==="ArrowDown")O();else if(s.key==="Enter"){const{index:t}=i;i.isQuery?(s.preventDefault(),o("updateQuery",d.value[t])):(u.push(m.value[t].link),A())}}}),le([a,h],()=>{document.querySelector(".slimsearch-record.active .slimsearch-record-matches.active")?.scrollIntoView(!1)},{flush:"post"}),()=>e("div",{id:"slimsearch-results",class:["slimsearch-result-wrapper",{empty:l.queries.length?!x.value:!q.value}]},l.queries.length?F.value?e(re,{hint:r.value.searching}):x.value?e("div",{class:"slimsearch-records",role:"listbox","aria-labeledby":"slimsearch-label"},p.value.map(({title:s,contents:t},v)=>{const c=a.value===v;return e("div",{class:["slimsearch-record",{active:c}],role:"group","aria-selected":c},[e("div",{class:"slimsearch-record-title"},s||r.value.defaultTitle),e("ul",{class:"slimsearch-record-contents"},t.map((n,K)=>{const L=c&&h.value===K;return e("li",{class:["slimsearch-record-matches",{active:L}],role:"option","aria-selected":L},e($,{to:Q(n),onClick:()=>{B(l.queries.join(" ")),w(n),A()}},()=>[n.type==="text"?null:e(n.type==="title"?ie:n.type==="heading"?oe:ue,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[n.type==="text"&&n.header?e("div",{class:"slimsearch-record-content-header"},n.header):null,e("div",G(n))])]))}))])})):r.value.emptyResult:q.value?[J(),W()]:r.value.emptyHistory)}});export{xe as default};
